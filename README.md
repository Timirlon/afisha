# Afisha
## Краткое описание
В рамках третьего этапа проекта, реализовал функциональность комментариев. Пользователи могут делиться комментариями на любое опубликованное событие, редактировать и удалять свои комментарии, а также отвечать на уже существующие комментарии. Админы имеют возможность удалять и скрывать комментарии. Для упрощения модерации комментариев также реализована возможность для пользователей оставлять жалобу на комментарий другого пользователя, которую позже смогут рассмотреть модераторы.

## Примеры эндпоинтов для функционала комментариев
- **Публичные эндпоинты**
  - `GET: /comments` - Получение списка комментариев к указанному событию
    Параметры запроса:

    | Параметр     | Тип       | Обязателен | Значение по умолчанию | Описание                             |
    | ------------ |-----------| ---------- | --------------------- | ------------------------------------ |
    | `event`      | `int`     | ✅          | —                     | ID события                           |
    | `from`       | `int`     | ❌          | `0`                   | Номер первого элемента для пагинации |
    | `size`       | `int`     | ❌          | `10`                  | Количество элементов на странице     |
    | `showHidden` | `boolean` | ❌          | `false`               | Показывать ли скрытые комментарии    |

    Метод: При обращении к эндпоинту вызывается метод `CommentPublicController.findAllByEvent()`  
    Ответ: Список объектов CommentShortDto отсортированный по дате создания (от новых к старым)  
    Пример тела ответа:

    ```json
    [
        {
            "id": 8,
            "text": "Пойдет",
            "event": 5086,
            "author": {
                "id": 6506,
                "name": "Marjorie Trantow"
            },
            "created": "2025-07-16 19:59:20",
            "updated": null
        },
        {
            "id": 6,
            "text": "Отличное мероприятие",
            "event": 5086,
            "author": {
                "id": 6505,
                "name": "Elmer Schulist"
            },
            "created": "2025-07-16 19:58:26",
            "updated": null
        }
    ]
    ```

  - `GET: /comments/{commentId}` - Получение подробной информации о комментарии, включая родительский комментарий и ответы (если присутствуют)

    Параметры пути:

    | Параметр     | Тип   | Описание                     |
        |--------------|--------|------------------------------|
    | `commentId`  | `int`  | ID запрашиваемого комментария |

    Параметры запроса:

    | Параметр     | Тип       | Обязателен | Значение по умолчанию | Описание                          |
        |--------------|-----------|------------|------------------------|-----------------------------------|
    | `showHidden` | `boolean` | ❌          | `false`                | Показывать ли скрытые комментарии |

    Метод: При обращении к эндпоинту вызывается метод `CommentPublicController.findById()`  
    Ответ: Объект `CommentFullDto` с информацией о комментарии, его родителе и вложенных ответах  
    Пример тела ответа:

    ```json
    {
      "id": 6,
      "text": "Отличное мероприятие",
      "event": 5086,
      "author": {
          "id": 6505,
          "name": "Elmer Schulist"
      },
      "created": "2025-07-16 19:58:26",
      "updated": null,
      "parent": null,
      "replies": [
        {
            "id": 9,
            "text": "Согласен",
            "event": 5086,
            "author": {
                "id": 6506,
                "name": "Marjorie Trantow"
            },
            "created": "2025-07-16 20:00:50",
            "updated": null
        }
      ]
    }
    ```

  - `GET: /comments/{commentId}/replies` - Получение списка ответов на указанный комментарий

    Параметры пути:

    | Параметр     | Тип   |  Описание                        |
        |--------------|--------|----------------------------------|
    | `commentId`  | `int`  | ID родительского комментария     |

    Параметры запроса:

    | Параметр     | Тип       | Обязателен | Значение по умолчанию | Описание                            |
        |--------------|-----------|------------|------------------------|-------------------------------------|
    | `from`       | `int`     | ❌          | `0`                    | Номер первого элемента              |
    | `size`       | `int`     | ❌          | `10`                   | Количество элементов на странице    |
    | `showHidden` | `boolean` | ❌          | `false`                | Показывать ли скрытые ответы        |

    Метод: При обращении к эндпоинту вызывается метод `CommentPublicController.findReplies()`  
    Ответ: Список объектов `CommentShortDto`, представляющих собой ответы на указанный комментарий  
    Пример тела ответа:

    ```json
    [
    {
          "id": 9,
          "text": "Согласен",
          "event": 5086,
          "author": {
              "id": 6506,
              "name": "Marjorie Trantow"
          },
          "created": "2025-07-16 20:00:50",
          "updated": null
      },
      {
          "id": 10,
          "text": "Не согласен",
          "event": 5086,
          "author": {
              "id": 6507,
              "name": "Becky Nolan"
          },
          "created": "2025-07-16 20:21:58",
          "updated": null
      }
    ]

    ```


---

- **Приватные эндпоинты (для пользователей)**

    - `POST: /users/{userId}/comments` — Создание нового комментария к событию

      Параметры пути:

      | Параметр  | Тип   | Описание           |
          |-----------|--------|--------------------|
      | `userId`  | `int`  | ID пользователя    |

      Параметры запроса:

      | Параметр  | Тип   | Обязателен | Описание         |
          |-----------|--------|------------|------------------|
      | `event`   | `int`  | ✅          | ID события       |

      Тело запроса (`CommentRequestDto`):

      ```json
      {
          "text": "Не согласен",
          "parent": 6
      }
      ```

      Метод: `CommentPrivateController.createNew()`  
      Ответ: объект `CommentFullDto` с данными созданного комментарием  
      Пример ответа:

      ```json
      {
          "id": 10,
          "text": "Не согласен",
          "event": 5086,
          "author": {
              "id": 6507,
              "name": "Becky Nolan"
          },
          "created": "2025-07-16 20:21:58",
          "updated": null,
          "parent": {
              "id": 6,
              "text": "Отличное мероприятие",
              "event": 5086,
              "author": {
                  "id": 6505,
                  "name": "Elmer Schulist"
              },
              "created": "2025-07-16 19:58:26",
              "updated": null
          },
          "replies": []
      }
      ```


    - `PATCH: /users/{userId}/comments/{commentId}` — Редактирование текста комментария
    
      Параметры пути:
    
      | Параметр     | Тип   | Описание              |
          |--------------|--------|------------------------|
      | `userId`     | `int`  | ID пользователя        |
      | `commentId`  | `int`  | ID комментария         |
    
      Тело запроса (`CommentRequestDto`):
    
      ```json
      {
          "text": "Смею возразить"
      }
      ```
    
      Метод: `CommentPrivateController.updateById()`  
      Ответ: Объект `CommentFullDto` с обновлённой информацией  
      Пример тела ответа:
    
      ```json
      {
          "id": 10,
          "text": "Смею возразить",
          "event": 5086,
          "author": {
              "id": 6507,
              "name": "Becky Nolan"
          },
          "created": "2025-07-16 20:21:58",
          "updated": "2025-07-16 20:37:29",
          "parent": {
              "id": 6,
              "text": "Отличное мероприятие",
              "event": 5086,
              "author": {
                  "id": 6505,
                  "name": "Elmer Schulist"
              },
              "created": "2025-07-16 19:58:26",
              "updated": null
          },
          "replies": []
      }
      ```
    
    
    
    - `DELETE: /users/{userId}/comments/{commentId}` — Удаление собственного комментария
    
      Параметры пути:
    
      | Параметр     | Тип   | Описание              |
          |--------------|--------|------------------------|
      | `userId`     | `int`  | ID пользователя        |
      | `commentId`  | `int`  | ID комментария         |
    
      Метод: `CommentPrivateController.deleteById()`  
      Ответ: HTTP статус `204 No Content` при успешном удалении.
    
    
    
    - `POST: /users/{userId}/comments/{commentId}/report` — Пожаловаться на комментарий
    
      Параметры пути:
    
      | Параметр     | Тип   | Описание              |
      |--------------|--------|------------------------|
      | `userId`     | `int`  | ID пользователя        |
      | `commentId`  | `int`  | ID комментария         |
    
      Тело запроса (`NewCommentReportDto`):
    
      ```json
      {
          "reason": "Спам и нецензурная лексика"
      }
      ```
    
      Метод: `CommentPrivateController.createNewReport()`  
      Ответ: объект `CommentReportDto`  
      Пример тела ответа:
    
      ```json
      {
          "id": 1,
          "reason": "Спам и нецензурная лексика",
          "created": "2025-07-16 20:47:29",
          "comment": 9,
          "reporter": {
              "id": 6507,
              "name": "Becky Nolan"
          },
          "status": "PENDING"
      }
      ```

---


- **Админские эндпоинты**

  - `PATCH: /admin/comments/{commentId}` — Обновление видимости комментария (меняет значение аттрибута hidden на true или false)

    Параметры пути:

    | Параметр     | Тип   | Описание               |
    |--------------|--------|------------------------|
    | `commentId`  | `int`  | ID комментария         |

    Параметры запроса:

    | Параметр     | Тип     | Обязателен | Описание                                |
    |--------------|----------|------------|-----------------------------------------|
    | `visibility` | `string` | ✅          | Изменение видимости комментария (`HIDE` / `UNHIDE`)  |

    Метод: `CommentAdminController.updateVisibility()`  
    Пример тела ответа: Объект `CommentFullDto`:

    ```json
      {
          "id": 7,
          "text": "Ок",
          "event": 5090,
          "author": {
              "id": 6506,
              "name": "Marjorie Trantow"
          },
          "created": "2025-07-16 19:58:54",
          "updated": null,
          "parent": null,
          "replies": []
      }
      ```

  - `DELETE: /admin/comments/{commentId}` — Удаление комментария администратором вручную

    Параметры пути:

    | Параметр     | Тип   | Описание               |
    |--------------|--------|------------------------|
    | `commentId`  | `int`  | ID комментария         |

    Метод: `CommentAdminController.deleteById()`  
    Ответ: HTTP статус `204 No Content` при успешном удалении


  - `GET: /admin/comments/reports` — Получение списка жалоб на все комментарии

    Параметры запроса:

    | Параметр  | Тип     | Обязателен | Значение по умолчанию | Описание                                 |
    |-----------|----------|------------|------------------------|------------------------------------------|
    | `sort`    | `string` | ❌          | `PENDING`              | Фильтр: `PENDING`, `APPROVED`, `REJECTED`, `ALL` |
    | `from`    | `int`    | ❌          | `0`                    | Индекс первого элемента                  |
    | `size`    | `int`    | ❌          | `10`                   | Количество элементов на странице         |

    Метод: `CommentAdminController.findReports()`  
    Пример тела ответа: Список объектов `CommentReportDto`  

    ```json
    [
        {
            "id": 1,
            "reason": "Спам и нецензурная лексика",
            "created": "2025-07-16 20:47:29",
            "comment": 9,
            "reporter": {
                "id": 6507,
                "name": "Becky Nolan"
            },
            "status": "PENDING"
        },
        {
            "id": 2,
            "reason": "Пропаганда терроризма",
            "created": "2025-07-16 21:15:12",
            "comment": 9,
            "reporter": {
                "id": 6510,
                "name": "Dennis Cummerata"
            },
            "status": "PENDING"
        },
        {
            "id": 3,
            "reason": "Нас держать подвал заставлять писать README.md ПОМОГИТ",
            "created": "2025-07-16 21:16:16",
            "comment": 6,
            "reporter": {
                "id": 6510,
                "name": "Dennis Cummerata"
            },
            "status": "PENDING"
        }
    ]
    ```


  - `GET: /admin/comments/{commentId}/reports` — Получение жалоб на конкретный комментарий

    Параметры пути:

    | Параметр     | Тип   | Описание               |
    |--------------|--------|------------------------|
    | `commentId`  | `int`  | ID комментария         |

    Параметры запроса:

    | Параметр  | Тип   | Обязателен | Значение по умолчанию | Описание                         |
    |-----------|--------|------------|------------------------|----------------------------------|
    | `from`    | `int`  | ❌          | `0`                    | Индекс первого элемента          |
    | `size`    | `int`  | ❌          | `10`                   | Количество элементов на странице |

    Метод: `CommentAdminController.findReportsByCommentId()`  
    Ответ: Список `CommentReportDto` по конкретному комментарию
    ```json
    [
        {
            "id": 3,
            "reason": "Нас держать подвал заставлять писать README.md ПОМОГИТ",
            "created": "2025-07-16 21:16:16",
            "comment": 6,
            "reporter": {
                "id": 6510,
                "name": "Dennis Cummerata"
            },
            "status": "PENDING"
        }
    ]
    ```

  - `PATCH: /admin/comments/reports` — Ответ на жалобы (массово)

    Пример тела запроса (`RespondToReportRequest`):

    ```json
    {
        "reports": [1],
        "action": "HIDE"
    }
    ```

    Возможные значения `action`:  
    - `HIDE` — скрыть комментарии  
    - `DELETE` — удалить комментарии  
    - `REJECT` — отклонить жалобы  

    Метод: `CommentAdminController.respondToReport()`  
    Ответ: Список объектов `CommentReportDto` с применённым действием
    ```json
    [
        {
            "id": 1,
            "reason": "Спам и нецензурная лексика",
            "created": "2025-07-16 20:47:29",
            "comment": 9,
            "reporter": {
                "id": 6507,
                "name": "Becky Nolan"
            },
            "status": "APPROVED"
        },
        {
            "id": 2,
            "reason": "Пропаганда терроризма",
            "created": "2025-07-16 21:15:12",
            "comment": 9,
            "reporter": {
                "id": 6510,
                "name": "Dennis Cummerata"
            },
            "status": "APPROVED"
        }
    ]
    ```


